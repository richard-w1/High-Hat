{% extends 'layout.html' %}

{% block title %}Overview - M.O.N.K.Y{% endblock %}

{% block content %}
<div class="card">
  {% if current_session %}
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
      <h2 style="margin: 0;">Current Session</h2>
      <div class="status monitoring">Active</div>
    </div>
    
    <div style="background: var(--muted); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1rem;">
      <p style="color: var(--muted-foreground); margin-bottom: 0.5rem;"><strong>Session ID:</strong> S-{{ current_session.id }}</p>
      <p style="margin: 0.5rem 0;"><strong>Description:</strong> {{ current_session.description or 'Monitoring backpack for potential theft incidents and unauthorized access.' }}</p>
      <p style="color: var(--muted-foreground); margin-top: 1rem;"><strong>Started:</strong> {{ current_session.started_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
    </div>

    {% set imgs = current_session.images if current_session else [] %}
    {% if imgs %}
      <div class="images">
        {% for img in imgs[:6] %}
          <img src="/static/{{ img }}" alt="Session capture {{ loop.index }}" />
        {% endfor %}
      </div>
    {% endif %}

  {% else %}
    <div style="text-align: center; padding: 3rem 1rem;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ”’</div>
      <h2>No Active Session</h2>
      <p style="color: var(--muted-foreground); margin: 1rem 0;">Your backpack monitoring system is currently inactive. Start a new session to begin monitoring.</p>
      <a href="/dashboard" class="btn" style="margin-top: 1rem;">Go to Live Monitor</a>
    </div>
  {% endif %}
</div>

<div class="card">
  <h3>Recent Sessions</h3>
  {% if sessions %}
    <table class="sessions-table">
      <thead>
        <tr>
          <th>Session ID</th>
          <th>Started</th>
          <th>Images</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for s in sessions[:5] %}
          <tr>
            <td style="color: var(--primary); font-weight: 600;">S-{{ s.id }}</td>
            <td>{{ s.started_at.strftime('%B %d, %Y at %I:%M %p') }}</td>
            <td>{{ s.images|length }}</td>
            <td>
              <a class="btn tiny" href="{{ url_for('session_detail', session_id=s.id) }}">View Details</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div style="text-align: center; margin-top: 1.5rem;">
      <a class="btn" href="{{ url_for('sessions_all') }}">View All Sessions</a>
    </div>
  {% else %}
    <div style="text-align: center; padding: 2rem; color: var(--muted-foreground);">
      <div style="font-size: 2rem; margin-bottom: 1rem;">ðŸ“‹</div>
      <p>No previous sessions found</p>
    </div>
  {% endif %}
</div>

{% if current_session %}
<div class="card">
  <h3>Session Statistics</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1rem;">
    <div style="background: var(--muted); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
      <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">{{ current_session.incidents|length }}</div>
      <div style="color: var(--muted-foreground); margin-top: 0.5rem;">Total Incidents</div>
    </div>
    <div style="background: var(--muted); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
      <div style="font-size: 2rem; font-weight: 700; color: var(--success);">{{ current_session.images|length }}</div>
      <div style="color: var(--muted-foreground); margin-top: 0.5rem;">Images Captured</div>
    </div>
    <div style="background: var(--muted); padding: 1.5rem; border-radius: var(--radius); text-align: center;">
      <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">{{ sessions|length }}</div>
      <div style="color: var(--muted-foreground); margin-top: 0.5rem;">Total Sessions</div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
